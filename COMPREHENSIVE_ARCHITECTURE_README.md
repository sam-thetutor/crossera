# STELLA Reward System - Complete Architecture Documentation

> **Comprehensive technical documentation for recreating the STELLA Reward System on any blockchain platform**

## ğŸ“‹ Table of Contents

1. [Project Overview](#project-overview)
2. [System Architecture](#system-architecture)
3. [Smart Contract Architecture](#smart-contract-architecture)
4. [Frontend Architecture](#frontend-architecture)
5. [Backend/API Architecture](#backendapi-architecture)
6. [SDK Architecture](#sdk-architecture)
7. [Implementation Plan for Different Blockchains](#implementation-plan-for-different-blockchains)
8. [Key Components Mapping](#key-components-mapping)
9. [Data Flow Diagrams](#data-flow-diagrams)
10. [Configuration Management](#configuration-management)

---

## ğŸ¯ Project Overview

The STELLA Reward System is a **retroactive funding platform** that rewards developers based on transaction volume generated by their applications. It combines:

- **Campaign Management**: Targeted funding initiatives for specific development goals
- **Reward Distribution**: Automated XLM token rewards based on transaction volume
- **Developer Registration**: App registration and tracking system
- **Transaction Verification**: Blockchain transaction verification and reward calculation
- **Leaderboards**: Performance tracking and analytics

### Core Business Logic

1. **Developers register applications** with unique App IDs
2. **Campaign creators** establish funding pools with specific criteria
3. **Developers join campaigns** by registering their apps
4. **Users generate transactions** with App IDs in memo fields
5. **Verifier service** validates transactions and calculates rewards
6. **Smart contract** distributes rewards based on volume and campaign rules

---

## ğŸ—ï¸ System Architecture

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STELLA Ecosystem                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Frontend  â”‚    â”‚   Backend   â”‚    â”‚   Smart     â”‚         â”‚
â”‚  â”‚   (Next.js) â”‚â—„â”€â”€â–ºâ”‚   (Next.js  â”‚â—„â”€â”€â–ºâ”‚   Contract  â”‚         â”‚
â”‚  â”‚             â”‚    â”‚   API)      â”‚    â”‚   (Rust)    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                   â”‚                   â”‚              â”‚
â”‚         â”‚                   â”‚                   â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚     SDK     â”‚    â”‚  Verifier   â”‚    â”‚   Stellar   â”‚         â”‚
â”‚  â”‚ (TypeScript)â”‚    â”‚   Service   â”‚    â”‚  Blockchain â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Component Responsibilities

| Component | Technology | Responsibility |
|-----------|------------|----------------|
| **Frontend** | Next.js 15, React 19, TypeScript | User interface, wallet connection, transaction management |
| **Backend API** | Next.js API Routes | Business logic, data processing, external integrations |
| **Smart Contract** | Rust/Soroban | Campaign management, reward distribution, state storage |
| **SDK** | TypeScript | Developer tools, transaction submission, app management |
| **Verifier** | Node.js/Express | Transaction verification, reward calculation |

---

## ğŸ¦€ Smart Contract Architecture

### Contract Structure (Rust/Soroban)

#### **Main Contract File**: `src/lib.rs`

```rust
#![no_std]

use soroban_sdk::{contract, contractimpl, Env, Address, String, Vec, symbol_short};

// Modular architecture with separate modules
mod types;
mod storage;
mod campaign;
mod reward;
mod leaderboard;

#[contract]
pub struct StellaRewardSystem;

#[contractimpl]
impl StellaRewardSystem {
    // Initialization
    pub fn init(e: Env, admin: Address, token_contract: Address, verifier: Option<Address>) -> Result<(), ContractError>
    
    // Campaign Management
    pub fn create_campaign(e: Env, creator: Address, name: String, description: String, total_pool: i128, start_date: u64, end_date: u64) -> Result<u32, ContractError>
    pub fn activate_campaign(e: Env, admin: Address, campaign_id: u32) -> Result<(), ContractError>
    pub fn register_app_for_campaign(e: Env, developer: Address, app_id: String, campaign_id: u32) -> Result<(), ContractError>
    
    // Reward Management
    pub fn submit_transaction_data(e: Env, verifier: Address, memo: String, tx_hash: String, fee_charged: i128, volume: i128) -> Result<(), ContractError>
    pub fn claim_rewards(e: Env, developer: Address, app_id: String, campaign_id: u32) -> Result<(), ContractError>
    
    // Analytics & Leaderboards
    pub fn get_campaign_leaderboard(e: Env, campaign_id: u32) -> Vec<CampaignLeaderboardEntry>
    pub fn get_app_leaderboard_stats(e: Env, app_id: String) -> AppLeaderboardStats
    pub fn get_global_leaderboard_stats(e: Env) -> GlobalLeaderboardStats
}
```

#### **Key Data Structures**

```rust
// Campaign Management
pub struct Campaign {
    pub id: u32,
    pub name: String,
    pub description: String,
    pub creator: Address,
    pub total_pool: i128,
    pub start_date: u64,
    pub end_date: u64,
    pub status: CampaignStatus,
    pub registered_apps_count: u32,
    pub total_transactions: u32,
    pub total_volume: i128,
}

// App Registration
pub struct AppInfo {
    pub id: String,
    pub name: String,
    pub developer: Address,
    pub registered_campaigns: Vec<u32>,
    pub total_rewards: i128,
    pub total_transactions: u32,
}

// Leaderboard Entries
pub struct CampaignLeaderboardEntry {
    pub app_id: String,
    pub app_name: String,
    pub developer: Address,
    pub total_volume: i128,
    pub total_fees: i128,
    pub transaction_count: u32,
    pub rank: u32,
}
```

#### **Storage Architecture**

```rust
// Persistent storage keys
pub enum StorageKey {
    Admin,
    TokenContract,
    Verifier,
    CampaignCount,
    AppCount,
    Campaign(u32),
    App(String),
    CampaignApps(u32),
    AppCampaigns(String),
    AppBalance(String, u32),
    CampaignStats(u32),
    GlobalStats,
}
```

### **Smart Contract Functions Mapping**

| Function Category | Functions | Purpose |
|-------------------|-----------|---------|
| **Initialization** | `init()` | Set up contract with admin, token, verifier |
| **Campaign Management** | `create_campaign()`, `activate_campaign()`, `end_campaign()`, `finalize_campaign()` | Full campaign lifecycle |
| **App Management** | `register_app()`, `register_app_for_campaign()` | App registration and campaign joining |
| **Reward Processing** | `submit_transaction_data()`, `claim_rewards()` | Transaction verification and reward distribution |
| **Analytics** | `get_campaign_leaderboard()`, `get_global_stats()` | Performance tracking |
| **Admin Functions** | `set_verifier()`, `recalculate_rankings()` | Administrative controls |

---

## ğŸŒ Frontend Architecture

### **Technology Stack**

```json
{
  "framework": "Next.js 15.5.3",
  "ui": "React 19.1.0",
  "language": "TypeScript",
  "styling": "Tailwind CSS 4",
  "wallet": "@creit.tech/stellar-wallets-kit",
  "blockchain": "@stellar/stellar-sdk",
  "build": "Turbopack"
}
```

### **Project Structure**

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ page.tsx           # Homepage with hero and video demo
â”‚   â”‚   â”œâ”€â”€ dashboard/         # Developer dashboard
â”‚   â”‚   â”œâ”€â”€ campaigns/         # Campaign management
â”‚   â”‚   â”œâ”€â”€ admin/            # Admin panel
â”‚   â”‚   â””â”€â”€ api/              # Backend API routes
â”‚   â”‚       â”œâ”€â”€ register/     # App registration
â”‚   â”‚       â”œâ”€â”€ submit/       # Transaction submission
â”‚   â”‚       â”œâ”€â”€ verify/       # Transaction verification
â”‚   â”‚       â”œâ”€â”€ campaigns/    # Campaign management
â”‚   â”‚       â””â”€â”€ leaderboard/  # Analytics and rankings
â”‚   â”œâ”€â”€ components/            # Reusable UI components
â”‚   â”‚   â”œâ”€â”€ Navbar.tsx        # Navigation with wallet integration
â”‚   â”‚   â”œâ”€â”€ NetworkSelector.tsx # Network switching
â”‚   â”‚   â”œâ”€â”€ VideoDemoSection.tsx # Demo video display
â”‚   â”‚   â””â”€â”€ CreateCampaignModal.tsx # Campaign creation
â”‚   â”œâ”€â”€ contexts/             # React Context providers
â”‚   â”‚   â”œâ”€â”€ WalletContext.tsx # Wallet connection management
â”‚   â”‚   â””â”€â”€ NetworkContext.tsx # Network state management
â”‚   â”œâ”€â”€ hooks/               # Custom React hooks
â”‚   â”‚   â”œâ”€â”€ useRewardContract.ts # Smart contract interactions
â”‚   â”‚   â”œâ”€â”€ useCampaigns.ts     # Campaign management
â”‚   â”‚   â”œâ”€â”€ useSendTransaction.ts # Transaction sending
â”‚   â”‚   â””â”€â”€ useAdmin.ts         # Admin functionality
â”‚   â””â”€â”€ lib/                 # Utilities and configuration
â”‚       â”œâ”€â”€ contracts.ts     # Contract addresses and config
â”‚       â”œâ”€â”€ serverConfig.ts  # Server-side configuration
â”‚       â””â”€â”€ contractValidator.ts # Contract validation
```

### **Key Frontend Components**

#### **1. Wallet Integration** (`contexts/WalletContext.tsx`)

```typescript
interface WalletContextType {
  isConnected: boolean;
  address: string | null;
  balance: string;
  isLoading: boolean;
  connect: () => Promise<void>;
  disconnect: () => void;
}

// Uses Stellar Wallets Kit for multi-wallet support
// Supports: Freighter, Lobstr, Albedo, Rabet, etc.
```

#### **2. Network Management** (`contexts/NetworkContext.tsx`)

```typescript
interface NetworkContextType {
  network: 'testnet' | 'mainnet';
  setNetwork: (network: NetworkType) => void;
  isTestnet: boolean;
  isMainnet: boolean;
  networkConfig: NetworkConfig;
}

// Handles network switching and configuration
// Currently testnet-only due to mainnet deployment issues
```

#### **3. Smart Contract Hooks** (`hooks/useRewardContract.ts`)

```typescript
// Campaign Management
export const useCampaigns = () => {
  const getCampaigns = (params: { limit?: number }) => Promise<Campaign[]>;
  const createCampaign = (campaignData: CreateCampaignData) => Promise<void>;
  const activateCampaign = (campaignId: number) => Promise<void>;
};

// App Registration
export const useRegisterApp = () => {
  const registerApp = (appData: RegisterAppData) => Promise<string>;
};

// Transaction Management
export const useSendTransaction = () => {
  const sendTransaction = (txData: TransactionData) => Promise<string>;
};
```

### **Frontend Data Flow**

```
User Action â†’ React Component â†’ Custom Hook â†’ API Route â†’ Smart Contract
     â†“              â†“              â†“           â†“            â†“
Wallet Connect â†’ WalletContext â†’ useWallet â†’ /api/register â†’ register_app()
Send Transaction â†’ TransactionForm â†’ useSendTransaction â†’ /api/submit â†’ submit_transaction_data()
Join Campaign â†’ CampaignCard â†’ useCampaigns â†’ /api/campaigns â†’ register_app_for_campaign()
```

---

## ğŸ”§ Backend/API Architecture

### **API Routes Structure**

```
frontend/src/app/api/
â”œâ”€â”€ register/route.ts           # App registration
â”œâ”€â”€ submit/route.ts            # Transaction submission
â”œâ”€â”€ verify/route.ts            # Transaction verification
â”œâ”€â”€ campaigns/
â”‚   â”œâ”€â”€ route.ts              # Campaign CRUD operations
â”‚   â”œâ”€â”€ active/route.ts       # Get active campaigns
â”‚   â””â”€â”€ [id]/route.ts         # Individual campaign operations
â”œâ”€â”€ developer-apps/[address]/route.ts  # Get developer's apps
â”œâ”€â”€ app-balance/[appId]/route.ts       # Get app balance
â”œâ”€â”€ app-stats/[appId]/route.ts         # Get app statistics
â”œâ”€â”€ leaderboard/
â”‚   â”œâ”€â”€ stats/route.ts        # Global statistics
â”‚   â””â”€â”€ [campaignId]/route.ts # Campaign leaderboard
â”œâ”€â”€ health/route.ts           # Health check
â”œâ”€â”€ contract-status/route.ts  # Contract health monitoring
â””â”€â”€ verifier-status/route.ts  # Verifier service status
```

### **Key API Endpoints**

#### **1. App Registration** (`/api/register`)

```typescript
POST /api/register
{
  "developer": "GAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWHF",
  "app_id": "my-app-123",
  "app_name": "My Application"
}

Response:
{
  "success": true,
  "appId": "my-app-123",
  "developer": "GAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWHF"
}
```

#### **2. Transaction Submission** (`/api/submit`)

```typescript
POST /api/submit
{
  "transaction_hash": "abc123...",
  "network": "testnet"
}

Response:
{
  "success": true,
  "transactionHash": "abc123...",
  "verificationStatus": "pending",
  "estimatedReward": "0.0000100"
}
```

#### **3. Campaign Management** (`/api/campaigns`)

```typescript
POST /api/campaigns
{
  "name": "DeFi Innovation Campaign",
  "description": "Supporting DeFi applications",
  "total_pool": 1000000000,
  "start_date": 1700000000,
  "end_date": 1730000000
}

Response:
{
  "success": true,
  "campaignId": 1,
  "campaign": { ... }
}
```

### **Backend Data Processing**

#### **Transaction Verification Flow**

```typescript
// 1. Receive transaction hash from frontend
// 2. Query Stellar Horizon API for transaction details
// 3. Validate memo contains registered App ID
// 4. Calculate reward based on transaction fee
// 5. Submit reward to smart contract
// 6. Update leaderboard rankings
// 7. Return verification result to frontend

async function verifyTransaction(txHash: string, network: string) {
  const tx = await horizon.transactions().transaction(txHash).call();
  const memo = tx.memo;
  const fee = tx.fee_charged;
  
  // Validate app registration
  const isRegistered = await checkAppRegistration(memo);
  if (!isRegistered) throw new Error('App not registered');
  
  // Calculate reward (10% of fee, minimum 0.0000001 XLM)
  const reward = Math.max(fee * 0.1, 1000000);
  
  // Submit to smart contract
  await submitRewardToContract(memo, txHash, fee, reward);
  
  return { success: true, reward };
}
```

---

## ğŸ“¦ SDK Architecture

### **SDK Structure** (`stella-verifier-sdk/`)

```
stella-verifier-sdk/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # Main SDK entry point
â”‚   â”œâ”€â”€ verifier.ts           # Core verification logic
â”‚   â”œâ”€â”€ types.ts              # TypeScript interfaces
â”‚   â”œâ”€â”€ react/
â”‚   â”‚   â”œâ”€â”€ index.ts          # React hooks
â”‚   â”‚   â””â”€â”€ hooks.ts          # useStellaReward, useAppRegistration
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ validation.ts     # Input validation
â”‚       â””â”€â”€ formatting.ts     # Data formatting
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ basic-usage.ts        # Simple integration example
â”‚   â”œâ”€â”€ react-example.tsx     # React component example
â”‚   â””â”€â”€ advanced-usage.ts     # Advanced features
â””â”€â”€ dist/                     # Compiled output
```

### **SDK Core Functions**

```typescript
// Main SDK Class
export class StellaVerifier {
  constructor(config: StellaConfig);
  
  // App Management
  async registerApp(appData: AppRegistrationData): Promise<string>;
  async getAppInfo(appId: string): Promise<AppInfo>;
  async getDeveloperApps(developer: string): Promise<AppInfo[]>;
  
  // Transaction Management
  async submitTransaction(txHash: string): Promise<VerificationResult>;
  async getTransactionStatus(txHash: string): Promise<TransactionStatus>;
  
  // Campaign Management
  async getActiveCampaigns(): Promise<Campaign[]>;
  async joinCampaign(appId: string, campaignId: number): Promise<boolean>;
  async getCampaignLeaderboard(campaignId: number): Promise<LeaderboardEntry[]>;
  
  // Reward Management
  async claimRewards(appId: string): Promise<ClaimResult>;
  async getAppBalance(appId: string): Promise<BalanceInfo>;
}

// React Hooks
export function useStellaReward(config: StellaConfig): {
  registerApp: (data: AppRegistrationData) => Promise<string>;
  submitTransaction: (txHash: string) => Promise<VerificationResult>;
  isLoading: boolean;
  error: string | null;
};

export function useAppRegistration(appId?: string): {
  appInfo: AppInfo | null;
  isLoading: boolean;
  error: string | null;
  register: (data: AppRegistrationData) => Promise<void>;
};
```

### **SDK Configuration**

```typescript
interface StellaConfig {
  apiUrl: string;                    // STELLA API endpoint
  network: 'testnet' | 'mainnet';    // Network selection
  contractAddress: string;           // Smart contract address
  rpcUrl: string;                    // Blockchain RPC endpoint
  horizonUrl: string;                // Blockchain explorer endpoint
}

// Default configuration
const defaultConfig: StellaConfig = {
  apiUrl: 'https://stellarrewards.xyz/api',
  network: 'testnet',
  contractAddress: 'CBSRFQCFB2W6RGGDY3SPY3IVMURRHXCIAR7J5C7DOCEX2PIIRXAA732L',
  rpcUrl: 'https://soroban-testnet.stellar.org',
  horizonUrl: 'https://horizon-testnet.stellar.org'
};
```

---

## ğŸš€ Implementation Plan for Different Blockchains

### **Phase 1: Architecture Analysis**

1. **Identify Target Blockchain**
   - Choose blockchain platform (Ethereum, Solana, Polygon, etc.)
   - Analyze smart contract capabilities
   - Review wallet integration options
   - Assess transaction verification methods

2. **Map Core Components**
   - Smart contract â†’ Target blockchain's contract system
   - Stellar SDK â†’ Target blockchain's SDK
   - Wallet integration â†’ Target blockchain's wallet providers
   - API structure â†’ Maintain similar REST API design

### **Phase 2: Smart Contract Migration**

#### **For Ethereum/EVM Chains:**

```solidity
// Solidity equivalent of Rust contract
contract StellaRewardSystem {
    struct Campaign {
        uint256 id;
        string name;
        string description;
        address creator;
        uint256 totalPool;
        uint256 startDate;
        uint256 endDate;
        CampaignStatus status;
        uint32 registeredAppsCount;
        uint32 totalTransactions;
        uint256 totalVolume;
    }
    
    struct AppInfo {
        string id;
        string name;
        address developer;
        uint256 totalRewards;
        uint32 totalTransactions;
    }
    
    // Campaign Management
    function createCampaign(
        string memory name,
        string memory description,
        uint256 totalPool,
        uint256 startDate,
        uint256 endDate
    ) external returns (uint256);
    
    function registerAppForCampaign(
        string memory appId,
        uint256 campaignId
    ) external;
    
    // Reward Management
    function submitTransactionData(
        string memory memo,
        bytes32 txHash,
        uint256 feeCharged,
        uint256 volume
    ) external onlyVerifier;
    
    function claimRewards(
        string memory appId,
        uint256 campaignId
    ) external;
}
```

#### **For Solana:**

```rust
// Anchor framework for Solana
use anchor_lang::prelude::*;

#[program]
pub mod stella_reward_system {
    use super::*;
    
    #[derive(Accounts)]
    pub struct CreateCampaign<'info> {
        #[account(init, payer = creator, space = Campaign::LEN)]
        pub campaign: Account<'info, Campaign>,
        #[account(mut)]
        pub creator: Signer<'info>,
        pub system_program: Program<'info, System>,
    }
    
    pub fn create_campaign(
        ctx: Context<CreateCampaign>,
        name: String,
        description: String,
        total_pool: u64,
        start_date: i64,
        end_date: i64,
    ) -> Result<()> {
        let campaign = &mut ctx.accounts.campaign;
        campaign.creator = ctx.accounts.creator.key();
        campaign.name = name;
        campaign.description = description;
        campaign.total_pool = total_pool;
        campaign.start_date = start_date;
        campaign.end_date = end_date;
        campaign.status = CampaignStatus::Pending;
        Ok(())
    }
}
```

### **Phase 3: Frontend Adaptation**

#### **Wallet Integration Changes**

```typescript
// Ethereum/EVM Wallets
import { useConnect, useAccount, useBalance } from 'wagmi';
import { InjectedConnector } from 'wagmi/connectors/injected';

// Solana Wallets
import { useWallet } from '@solana/wallet-adapter-react';
import { PhantomWalletAdapter } from '@solana/wallet-adapter-phantom';

// Generic wallet interface
interface WalletAdapter {
  connect(): Promise<void>;
  disconnect(): void;
  signTransaction(transaction: any): Promise<any>;
  getAddress(): string | null;
  getBalance(): Promise<string>;
}
```

#### **Blockchain SDK Integration**

```typescript
// Ethereum/EVM
import { ethers } from 'ethers';
import { Contract } from 'ethers';

// Solana
import { Connection, PublicKey, Transaction } from '@solana/web3.js';
import { Program, AnchorProvider } from '@coral-xyz/anchor';

// Generic blockchain interface
interface BlockchainAdapter {
  connect(): Promise<void>;
  getContract(address: string, abi: any): Contract;
  sendTransaction(tx: any): Promise<string>;
  getTransaction(txHash: string): Promise<TransactionInfo>;
  getBalance(address: string): Promise<string>;
}
```

### **Phase 4: API Adaptation**

#### **Transaction Verification Changes**

```typescript
// Ethereum transaction verification
async function verifyEthereumTransaction(txHash: string) {
  const provider = new ethers.providers.JsonRpcProvider(RPC_URL);
  const tx = await provider.getTransaction(txHash);
  
  // Extract app ID from transaction input data or logs
  const appId = extractAppIdFromTransaction(tx);
  
  // Calculate gas fee as reward basis
  const gasUsed = tx.gasLimit.mul(tx.gasPrice);
  const reward = gasUsed.div(10); // 10% of gas fee
  
  return { appId, reward, volume: tx.value };
}

// Solana transaction verification
async function verifySolanaTransaction(txHash: string) {
  const connection = new Connection(RPC_URL);
  const tx = await connection.getTransaction(txHash);
  
  // Extract app ID from instruction data
  const appId = extractAppIdFromInstructions(tx);
  
  // Calculate compute units as reward basis
  const computeUnits = tx.meta.computeUnitsConsumed;
  const reward = Math.floor(computeUnits / 10); // 10% of compute units
  
  return { appId, reward, volume: tx.meta.fee };
}
```

---

## ğŸ”„ Key Components Mapping

### **Core Functionality Translation**

| STELLA Component | Stellar Implementation | Generic Implementation |
|------------------|----------------------|----------------------|
| **Smart Contract** | Rust/Soroban | Solidity (EVM), Anchor (Solana), Move (Aptos) |
| **Wallet Integration** | Stellar Wallets Kit | Wagmi (EVM), Wallet Adapter (Solana) |
| **Transaction Verification** | Horizon API | Etherscan API, Solana RPC, Block explorers |
| **Reward Calculation** | Transaction fee based | Gas fee (EVM), Compute units (Solana) |
| **Storage** | Soroban persistent storage | EVM storage, Solana PDAs |
| **Events** | Soroban events | EVM events, Solana program logs |

### **Data Structure Mapping**

```typescript
// Generic data structures that work across blockchains
interface Campaign {
  id: number;
  name: string;
  description: string;
  creator: string;        // Wallet address
  totalPool: bigint;      // Reward pool amount
  startDate: number;      // Unix timestamp
  endDate: number;        // Unix timestamp
  status: CampaignStatus;
  registeredAppsCount: number;
  totalTransactions: number;
  totalVolume: bigint;
}

interface AppInfo {
  id: string;             // Unique app identifier
  name: string;
  developer: string;      // Wallet address
  registeredCampaigns: number[];
  totalRewards: bigint;
  totalTransactions: number;
}

interface TransactionData {
  hash: string;           // Transaction hash
  appId: string;          // App identifier from memo/data
  fee: bigint;            // Transaction fee
  volume: bigint;         // Transaction volume
  timestamp: number;      // Block timestamp
}
```

---

## ğŸ“Š Data Flow Diagrams

### **Campaign Creation Flow**

```
Campaign Creator â†’ Frontend Form â†’ API Route â†’ Smart Contract
       â†“              â†“              â†“           â†“
   Fill Details â†’ Validation â†’ create_campaign() â†’ Campaign Created
       â†“              â†“              â†“           â†“
   Submit Form â†’ POST /api/campaigns â†’ Contract Call â†’ Event Emitted
       â†“              â†“              â†“           â†“
   Success UI â† API Response â† Contract Response â† Campaign ID
```

### **Transaction Verification Flow**

```
User Transaction â†’ Blockchain â†’ Verifier Service â†’ Smart Contract
       â†“              â†“              â†“              â†“
  Send with App ID â†’ Transaction â†’ Verify & Calculate â†’ Submit Reward
       â†“              â†“              â†“              â†“
   Get TX Hash â†’ Query Explorer â†’ Reward Calculation â†’ Update Balance
       â†“              â†“              â†“              â†“
  Submit Hash â†’ Extract App ID â†’ Calculate 10% Fee â†’ Claim Available
```

### **Reward Claiming Flow**

```
Developer â†’ Dashboard â†’ Claim Button â†’ Smart Contract
    â†“           â†“           â†“             â†“
  View Balance â†’ Check App â†’ claim_rewards() â†’ Transfer XLM
    â†“           â†“           â†“             â†“
  See Balance â†’ Select App â†’ Contract Call â†’ Balance Updated
    â†“           â†“           â†“             â†“
  Success UI â† API Response â† Transfer Event â† Rewards Claimed
```

---

## âš™ï¸ Configuration Management

### **Environment Variables**

```bash
# Smart Contract Configuration
CONTRACT_ADDRESS=your_contract_address
ADMIN_ADDRESS=your_admin_address
VERIFIER_ADDRESS=your_verifier_address
TOKEN_CONTRACT=your_token_contract

# Network Configuration
RPC_URL=your_blockchain_rpc_url
HORIZON_URL=your_blockchain_explorer_url
NETWORK_PASSPHRASE=your_network_passphrase

# Verifier Configuration
VERIFIER_SECRET=your_verifier_secret_key
MIN_REWARD_LU=1000000

# Frontend Configuration
NEXT_PUBLIC_CONTRACT_ADDRESS=your_contract_address
NEXT_PUBLIC_RPC_URL=your_rpc_url
NEXT_PUBLIC_NETWORK=testnet_or_mainnet
```

### **Network-Specific Configuration**

```typescript
// Configuration for different blockchains
const NETWORK_CONFIGS = {
  ethereum: {
    rpcUrl: 'https://mainnet.infura.io/v3/YOUR_KEY',
    explorerUrl: 'https://api.etherscan.io/api',
    contractAddress: '0x...',
    nativeToken: 'ETH',
    decimals: 18
  },
  polygon: {
    rpcUrl: 'https://polygon-rpc.com',
    explorerUrl: 'https://api.polygonscan.com/api',
    contractAddress: '0x...',
    nativeToken: 'MATIC',
    decimals: 18
  },
  solana: {
    rpcUrl: 'https://api.mainnet-beta.solana.com',
    explorerUrl: 'https://api.solscan.io',
    contractAddress: '...',
    nativeToken: 'SOL',
    decimals: 9
  }
};
```

---

## ğŸ¯ Implementation Checklist

### **Phase 1: Setup & Infrastructure**
- [ ] Choose target blockchain platform
- [ ] Set up development environment
- [ ] Create project structure
- [ ] Configure wallet integration
- [ ] Set up testing framework

### **Phase 2: Smart Contract Development**
- [ ] Implement core data structures
- [ ] Create campaign management functions
- [ ] Implement reward distribution logic
- [ ] Add admin and verifier controls
- [ ] Implement leaderboard functionality
- [ ] Add comprehensive testing

### **Phase 3: Backend API Development**
- [ ] Create API route structure
- [ ] Implement transaction verification
- [ ] Add campaign management endpoints
- [ ] Create analytics and leaderboard APIs
- [ ] Add health monitoring endpoints
- [ ] Implement error handling and logging

### **Phase 4: Frontend Development**
- [ ] Set up Next.js project structure
- [ ] Implement wallet connection
- [ ] Create campaign management UI
- [ ] Build developer dashboard
- [ ] Add transaction submission interface
- [ ] Implement admin panel
- [ ] Add responsive design and styling

### **Phase 5: SDK Development**
- [ ] Create TypeScript SDK
- [ ] Implement React hooks
- [ ] Add comprehensive documentation
- [ ] Create usage examples
- [ ] Publish to package registry
- [ ] Add testing and validation

### **Phase 6: Testing & Deployment**
- [ ] Comprehensive integration testing
- [ ] Security audit
- [ ] Performance optimization
- [ ] Deployment to testnet
- [ ] User acceptance testing
- [ ] Mainnet deployment

---

## ğŸ“š Additional Resources

### **Technology References**
- [Next.js Documentation](https://nextjs.org/docs)
- [React 19 Features](https://react.dev/blog/2024/12/05/react-19)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)

### **Blockchain-Specific Resources**
- **Ethereum**: [Solidity Documentation](https://docs.soliditylang.org/)
- **Solana**: [Anchor Framework](https://www.anchor-lang.com/)
- **Polygon**: [Polygon Developer Docs](https://docs.polygon.technology/)

### **Wallet Integration**
- **EVM**: [Wagmi Documentation](https://wagmi.sh/)
- **Solana**: [Wallet Adapter](https://github.com/solana-labs/wallet-adapter)

This comprehensive documentation provides everything needed to recreate the STELLA Reward System on any blockchain platform, maintaining the same core functionality while adapting to different blockchain architectures and technologies.
